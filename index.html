<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>æœ¬åœŸåœ–æ›¸æ¨è–¦æŸ¥è©¢</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;600;700&display=swap');
    body{font-family:'Noto Sans TC',sans-serif}
    .filter-btn.active{background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);color:#fff;transform:translateY(-1px)}
    @keyframes fadeIn{from{opacity:0;transform:translateY(6px)}to{opacity:1;transform:translateY(0)}}
    .fade-in{animation:fadeIn .25s ease-out}
    details>summary::-webkit-details-marker{display:none}
  </style>
</head>
<body class="bg-gradient-to-br from-rose-50 via-indigo-50 to-sky-50 min-h-screen">
  <main class="container mx-auto p-4 sm:p-6 md:p-8 max-w-7xl">
    <section class="bg-white/90 backdrop-blur-sm rounded-3xl shadow-2xl p-6 md:p-10 border border-white/30">
      <header class="text-center mb-8">
        <h1 class="text-3xl sm:text-5xl font-extrabold bg-gradient-to-r from-purple-600 to-blue-600 bg-clip-text text-transparent">æœ¬åœŸåœ–æ›¸æ¨è–¦æŸ¥è©¢</h1>
        <p class="mt-2 text-gray-600">è³‡æ–™ä¾†æºï¼š<span class="font-medium text-blue-700">å–œé–±ç¶²</span>ï¼‹<span class="font-medium text-green-700">å¸ƒå¯æ˜Ÿçƒ</span></p>
      </header>

      <!-- å¹´ç´šç¯©é¸ -->
      <div class="mb-6">
        <!-- æ‰‹æ©Ÿç‰ˆï¼šæ”¶åˆåˆ‡æ›åˆ— -->
        <button id="filter-toggle" class="sm:hidden w-full flex items-center justify-between px-4 py-2.5 rounded-2xl bg-gradient-to-r from-purple-50 to-blue-50 border border-purple-200 text-sm font-medium text-purple-700 mb-2" onclick="toggleFilter()">
          <span id="filter-toggle-label">ç¯©é¸å¹´ç´šï¼šğŸŒŸ å…¨éƒ¨</span>
          <svg id="filter-toggle-icon" class="w-5 h-5 transition-transform duration-200" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/></svg>
        </button>
        <!-- æŒ‰éˆ•å€ï¼šæ‰‹æ©Ÿé è¨­éš±è—ï¼Œæ¡Œé¢æ°¸é é¡¯ç¤º -->
        <div id="filter-panel" class="hidden sm:flex flex-wrap justify-center gap-2 sm:gap-3">
          <div class="flex flex-wrap justify-center gap-2 sm:gap-3 w-full" id="filter-controls">
            <button class="filter-btn active px-4 sm:px-6 py-2 rounded-full bg-gray-100 hover:bg-gray-200" data-grade="all">ğŸŒŸ å…¨éƒ¨</button>
            <button class="filter-btn px-4 sm:px-6 py-2 rounded-full bg-gray-100 hover:bg-gray-200" data-grade="ä½">ğŸŒ± ä½å¹´ç´š</button>
            <button class="filter-btn px-4 sm:px-6 py-2 rounded-full bg-gray-100 hover:bg-gray-200" data-grade="ä¸­">ğŸŒ¿ ä¸­å¹´ç´š</button>
            <button class="filter-btn px-4 sm:px-6 py-2 rounded-full bg-gray-100 hover:bg-gray-200" data-grade="é«˜">ğŸŒ³ é«˜å¹´ç´š</button>
          </div>
        </div>
      </div>

      <!-- é—œéµå­—æœå°‹ -->
      <div class="max-w-2xl mx-auto mb-6">
        <div class="relative">
          <input id="search-input" class="w-full px-5 py-3 pl-12 rounded-2xl border-2 border-gray-200 focus:outline-none focus:border-purple-500 focus:ring-4 focus:ring-purple-100" placeholder="æœå°‹ï¼šæ›¸å / ä½œè€… / å‡ºç‰ˆç¤¾ / ISBN" />
          <svg class="absolute left-4 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-5.2-5.2M15 10a5 5 0 11-10 0 5 5 0 0110 0z"/>
          </svg>
        </div>
      </div>

      <div class="text-center mb-4">
        <span id="result-count" class="inline-flex items-center px-3 py-1 rounded-full text-sm bg-gradient-to-r from-purple-100 to-blue-100 text-purple-800"></span>
      </div>

      <!-- è³‡æ–™è¡¨ -->
      <div id="table-wrap" class="overflow-x-auto rounded-2xl border border-gray-200 shadow-inner bg-gray-50/70 hidden">
        <table class="w-full min-w-[900px] text-sm">
          <thead class="bg-gradient-to-r from-purple-600 to-blue-600 text-white">
            <tr>
              <th class="px-4 py-3 text-left">æ›¸å</th>
              <th class="px-4 py-3 text-left">ä½œè€…/ç¹ªè€…</th>
              <th class="px-4 py-3 text-left">å‡ºç‰ˆç¤¾</th>
              <th class="px-4 py-3 text-center">å»ºè­°å¹´ç´š</th>
              <th class="px-4 py-3 text-center">ä¾†æº</th>
              <th class="px-4 py-3 text-center">è³‡è¨Š</th>
            </tr>
          </thead>
          <tbody id="tbody" class="divide-y divide-gray-200"></tbody>
        </table>
      </div>

      <div id="no-results" class="hidden text-center py-12">
        <p class="text-gray-600 text-lg">æ‰¾ä¸åˆ°çµæœï¼Œè«‹èª¿æ•´ç¯©é¸æˆ–é—œéµå­—ã€‚</p>
      </div>
    </section>

    <footer class="text-center mt-6 text-gray-600 text-sm">
      <p>Â© Christina Yu | æœ¬é é¢åƒ…ä¾›æ•™å­¸èˆ‡æŸ¥è©¢ä½¿ç”¨</p>
    </footer>
  </main>

  <!-- å›åˆ°é ‚éƒ¨æŒ‰éˆ• -->
  <button id="back-to-top" onclick="window.scrollTo({top:0,behavior:'smooth'})"
    class="fixed bottom-6 right-6 w-12 h-12 rounded-full bg-gradient-to-r from-purple-600 to-blue-600 text-white shadow-lg flex items-center justify-center opacity-0 pointer-events-none transition-all duration-300 hover:scale-110 z-50"
    aria-label="å›åˆ°é ‚éƒ¨">
    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 15l7-7 7 7"/></svg>
  </button>

  <script>
    const tbody = document.getElementById("tbody");
    const resultCount = document.getElementById("result-count");
    const tableWrap = document.getElementById("table-wrap");
    const noResults = document.getElementById("no-results");
    const searchInput = document.getElementById("search-input");
    const filterControls = document.getElementById("filter-controls");
    const filterPanel = document.getElementById("filter-panel");
    const filterToggle = document.getElementById("filter-toggle");
    const filterToggleLabel = document.getElementById("filter-toggle-label");
    const filterToggleIcon = document.getElementById("filter-toggle-icon");
    const backToTop = document.getElementById("back-to-top");

    const gradeLabels = { all:"ğŸŒŸ å…¨éƒ¨", "ä½":"ğŸŒ± ä½å¹´ç´š", "ä¸­":"ğŸŒ¿ ä¸­å¹´ç´š", "é«˜":"ğŸŒ³ é«˜å¹´ç´š" };
    let filterOpen = false;

    function toggleFilter(){
      filterOpen = !filterOpen;
      filterPanel.classList.toggle("hidden", !filterOpen);
      filterPanel.classList.toggle("flex", filterOpen);
      filterToggleIcon.style.transform = filterOpen ? "rotate(180deg)" : "";
    }

    // å›åˆ°é ‚éƒ¨æŒ‰éˆ•ï¼šæ»¾è¶…é 300px æ‰é¡¯ç¤º
    window.addEventListener("scroll", ()=>{
      const show = window.scrollY > 300;
      backToTop.style.opacity = show ? "1" : "0";
      backToTop.style.pointerEvents = show ? "auto" : "none";
    });

    let ALL = [];
    let gradeFilter = "all";
    let q = "";

    function badge(source){
      const cls = source === "å–œé–±ç¶²" ? "bg-blue-100 text-blue-700 border border-blue-200" : "bg-green-100 text-green-700 border border-green-200";
      return `<span class="inline-flex items-center px-2 py-0.5 rounded-full text-xs ${cls}">${source}</span>`;
    }

    function safe(v){ return (v ?? "").toString(); }

    function render(){
      let arr = ALL.filter(b => gradeFilter === "all" ? true : (safe(b.grade_category) === gradeFilter));
      const term = q.trim().toLowerCase();
      if(term){
        arr = arr.filter(b => [b.title, b.author, b.publisher, b.isbn].map(x => safe(x).toLowerCase()).some(s => s.includes(term)));
      }

      tbody.innerHTML = "";
      resultCount.textContent = `ğŸ“š å…± ${arr.length} æœ¬`;

      if(arr.length === 0){
        tableWrap.classList.add("hidden");
        noResults.classList.remove("hidden");
        return;
      } else {
        tableWrap.classList.remove("hidden");
        noResults.classList.add("hidden");
      }

      arr.forEach((b,i)=>{
        const gradeDisp = b.grade_specific && b.grade_specific.trim()
          ? b.grade_specific
          : (safe(b.grade_category) ? `<span class="text-gray-400 italic">ï¼ˆ${safe(b.grade_category)}å¹´ç´šï¼‰</span>` : "");

        const hasTranslator = b.translator && b.translator.trim();

        const details = `
          <details class="group">
            <summary class="cursor-pointer select-none flex items-center justify-center gap-1 text-indigo-700 hover:underline">
              <span>æ›´å¤š</span>
              <svg class="w-4 h-4 transition-transform group-open:rotate-180" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M5.23 7.21a.75.75 0 011.06.02L10 11.116l3.71-3.885a.75.75 0 111.08 1.04l-4.24 4.44a.75.75 0 01-1.08 0L5.21 8.27a.75.75 0 01.02-1.06z" clip-rule="evenodd"/></svg>
            </summary>
            <div class="mt-2 text-xs text-gray-600 px-2 pb-2">
              <div><span class="text-gray-500">å‡ºç‰ˆæ—¥æœŸï¼š</span>${safe(b.publication_date) || "â€”"}</div>
              <div><span class="text-gray-500">ISBNï¼š</span>${safe(b.isbn) || "â€”"}</div>
              ${hasTranslator ? `<div><span class="text-gray-500">è­¯è€…ï¼š</span>${safe(b.translator)}</div>` : ""}
            </div>
          </details>
        `;

        const tr = document.createElement("tr");
        tr.className = "bg-white hover:bg-gradient-to-r hover:from-purple-50 hover:to-blue-50 transition-all fade-in";
        tr.style.animationDelay = (i*0.01)+"s";
        tr.innerHTML = `
          <td class="px-4 py-3 font-medium">${safe(b.title)}</td>
          <td class="px-4 py-3 whitespace-pre-wrap text-gray-700">${safe(b.author)}</td>
          <td class="px-4 py-3">${safe(b.publisher)}</td>
          <td class="px-4 py-3 text-center">${gradeDisp || " "}</td>
          <td class="px-4 py-3 text-center">${badge(safe(b.source))}</td>
          <td class="px-4 py-3 text-center">${details}</td>
        `;
        tbody.appendChild(tr);
      });
    }

    filterControls.addEventListener("click", (e)=>{
      if(e.target.matches("button.filter-btn")){
        filterControls.querySelectorAll("button.filter-btn").forEach(b=>b.classList.remove("active"));
        e.target.classList.add("active");
        gradeFilter = e.target.dataset.grade;
        // æ›´æ–°æ‰‹æ©Ÿç‰ˆåˆ‡æ›åˆ—æ–‡å­—ï¼Œä¸¦è‡ªå‹•æ”¶èµ·
        filterToggleLabel.textContent = "ç¯©é¸å¹´ç´šï¼š" + (gradeLabels[gradeFilter] || gradeFilter);
        if(filterOpen && window.innerWidth < 640){ toggleFilter(); }
        render();
      }
    });

    searchInput.addEventListener("input", (e)=>{
      q = e.target.value;
      render();
    });

    (async function(){
      try{
        const res = await fetch("books.json", {cache: "no-store"});
        const data = await res.json();
        ALL = data.books || [];
      }catch(err){
        console.error("è¼‰å…¥ books.json å¤±æ•—ï¼š", err);
        ALL = [];
      }
      render();
      tableWrap.classList.toggle("hidden", ALL.length===0);
      noResults.classList.toggle("hidden", ALL.length!==0);
    })();
  </script>
</body>
</html>